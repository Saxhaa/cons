<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Poème du Jour - The Agence</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Lato">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <header>
        <h1>Conservatoire</h1>
        <nav>
            <ul class="navigationLinks">
                <li class="liste1"><a href="index.html">Accueil</a></li>
                <li class="liste1"><a href="prediction.html">Prédictions divinatoires</a></li>
                <li class="liste2"><a href="poeme-du-jour.html">Poétesse du jour</a></li>
                <li class="liste1"><a href="horoscope.html">Horoscope</a></li>
            </ul>
        </nav>
    </header>

       <main>
        <section class="poem-section">
            <h2>Poetesse du jour</h2>
            <p>Chaque jour, sélection aléatoire de poèmes écrits par une femme.<br>La boss lady du jour</p>
            <div class="poem-container" id="poemContainer">
                <p class="loading">Recherche d'un poème ...</p>
            </div>
        </section>
    </main>

    <footer>
        <div>
            <span>&copy; Copyright 2025. By Sachouille Fripouille</span>
        </div>
    </footer>

    <script>
        // Liste d'autrices francophones (FEMMES UNIQUEMENT)
        const autrices = [
            // Moyen Âge et Renaissance
            { name: "Marie de France", wikisource: "Marie_de_France" },
            { name: "Christine de Pizan", wikisource: "Christine_de_Pizan" },
            { name: "Louise Labé", wikisource: "Louise_Labé" },
            { name: "Marguerite de Navarre", wikisource: "Marguerite_de_Navarre" },
            { name: "Pernette du Guillet", wikisource: "Pernette_du_Guillet" },
            
            // XVIIe siècle
            { name: "Antoinette Deshoulières", wikisource: "Antoinette_Deshoulières" },
            { name: "Madeleine de Scudéry", wikisource: "Madeleine_de_Scudéry" },
            
            // XVIIIe siècle
            { name: "Olympe de Gouges", wikisource: "Olympe_de_Gouges" },
            { name: "Constance de Salm", wikisource: "Constance_de_Salm" },
            
            // XIXe siècle
            { name: "Marceline Desbordes-Valmore", wikisource: "Marceline_Desbordes-Valmore" },
            { name: "Amable Tastu", wikisource: "Amable_Tastu" },
            { name: "Louise Ackermann", wikisource: "Louise_Ackermann" },
            { name: "Malvina Blanchecotte", wikisource: "Malvina_Blanchecotte" },
            { name: "Delphine de Girardin", wikisource: "Delphine_de_Girardin" },
            { name: "Louise Colet", wikisource: "Louise_Colet" },
            { name: "Louisa Siefert", wikisource: "Louisa_Siefert" },
            { name: "Élisa Mercœur", wikisource: "Élisa_Mercœur" },
            
            // Fin XIXe - début XXe siècle
            { name: "Marie Krysinska", wikisource: "Marie_Krysinska" },
            { name: "Anna de Noailles", wikisource: "Anna_de_Noailles" },
            { name: "Renée Vivien", wikisource: "Renée_Vivien" },
            { name: "Marie Noël", wikisource: "Marie_Noël" },
            { name: "Cécile Sauvage", wikisource: "Cécile_Sauvage" },
            { name: "Lucie Delarue-Mardrus", wikisource: "Lucie_Delarue-Mardrus" },
            { name: "Rachilde", wikisource: "Rachilde" },
            { name: "Judith Gautier", wikisource: "Judith_Gautier" },
            { name: "Marie Dauguet", wikisource: "Marie_Dauguet" },
            { name: "Catherine Pozzi", wikisource: "Catherine_Pozzi" },
            { name: "Hélène Vacaresco", wikisource: "Hélène_Vacaresco" },
            { name: "Marie de Régnier", wikisource: "Marie_de_Régnier" },
            
            // XXe siècle
            { name: "Andrée Chedid", wikisource: "Andrée_Chedid" },
            { name: "Joyce Mansour", wikisource: "Joyce_Mansour" }
            
        ];

        // Fonction pour afficher un poème écrit par une femme
        async function afficherPoemeDuJour() {
            const container = document.getElementById("poemContainer");
            container.innerHTML = '<p class="loading">Recherche d\'un poème écrit par une femme...</p>';

            try {
                // Récupérer la date du jour pour une sélection unique
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));

                // Sélectionner une autrice basée sur le jour de l'année
                const autriceIndex = dayOfYear % autrices.length;
                const autrice = autrices[autriceIndex];

                // Essayer plusieurs stratégies de recherche
                let data = null;
                
                // Stratégie 1: Recherche par nom Wikisource
                try {
                    const url1 = `https://fr.wikisource.org/w/api.php?action=query&format=json&origin=*&list=search&srsearch=${encodeURIComponent(autrice.wikisource)}&srnamespace=0&srlimit=30`;
                    console.log("Tentative 1:", url1);
                    const response1 = await fetch(url1);
                    if (response1.ok) {
                        data = await response1.json();
                    }
                } catch (e) {
                    console.log("Stratégie 1 échouée:", e);
                }

                // Stratégie 2: Si échec, chercher par nom complet
                if (!data || !data.query || !data.query.search || data.query.search.length === 0) {
                    try {
                        const url2 = `https://fr.wikisource.org/w/api.php?action=opensearch&format=json&origin=*&search=${encodeURIComponent(autrice.name)}&limit=30`;
                        console.log("Tentative 2:", url2);
                        const response2 = await fetch(url2);
                        if (response2.ok) {
                            const opensearchData = await response2.json();
                            // Convertir le format opensearch en format query
                            if (opensearchData && opensearchData[1] && opensearchData[1].length > 0) {
                                data = {
                                    query: {
                                        search: opensearchData[1].map((title, idx) => ({
                                            title: title,
                                            pageid: idx
                                        }))
                                    }
                                };
                            }
                        }
                    } catch (e) {
                        console.log("Stratégie 2 échouée:", e);
                    }
                }

                // Afficher les résultats
                if (data && data.query && data.query.search && data.query.search.length > 0) {
                    // Utiliser le jour comme graine pour sélectionner un texte spécifique
                    const textIndex = dayOfYear % data.query.search.length;
                    const page = data.query.search[textIndex];

                    // Afficher le texte
                    container.innerHTML = `
                        <h3 class="poem-title">${page.title}</h3>
                        <p class="poem-author">— ${autrice.name}</p>
                        <a href="https://fr.wikisource.org/wiki/${encodeURIComponent(page.title.replace(/ /g, "_"))}" target="_blank" class="wikisource-link">Lire sur Wikisource</a>
                        <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                            Texte sélectionné parmi les œuvres de ${autrice.name}.
                        </p>
                    `;
                } else {
                    // Solution de repli : lien direct vers la page auteur
                    container.innerHTML = `
                        <h3 class="poem-title">${autrice.name}</h3>
                        <p class="poem-author">Poétesse du jour</p>
                        <a href="https://fr.wikisource.org/wiki/${autrice.wikisource}" target="_blank" class="wikisource-link">
                            Découvrir ses œuvres sur Wikisource
                        </a>
                        <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                            Explorez l'œuvre complète de ${autrice.name}.
                        </p>
                    `;
                }
            } catch (error) {
                console.error("Erreur lors de la recherche du poème :", error);
                
                // En cas d'erreur totale, afficher quand même l'autrice du jour
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                const autriceIndex = dayOfYear % autrices.length;
                const autrice = autrices[autriceIndex];
                
                container.innerHTML = `
                    <h3 class="poem-title">${autrice.name}</h3>
                    <p class="poem-author">Poétesse du jour</p>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666;">
                        Une erreur s'est produite lors de la connexion à Wikisource.
                    </p>
                    <a href="https://fr.wikisource.org/wiki/${autrice.wikisource}" target="_blank" class="wikisource-link">
                        Visiter la page Wikisource
                    </a>
                `;
            }
        }

        // Afficher le poème du jour au chargement de la page
        window.onload = afficherPoemeDuJour;
    </script>
</body>
</html>